<!DOCTYPE html>
<html lang="en">

<head>

	<!-- Page style and script -->
	<script type='application/javascript' src='http://demo.insidemaps.com/apis/build/imapi.min.js'></script>

	<title>InsideMaps AAM Demo</title>

	<style>
		.content-container {
			position: relative;
			width: 946px;
			display: block;
			margin-left: auto;
			margin-right: auto;
		}

		.virtual-tour-container {
			position: relative;
			width: 100%;
			height: 530px;
		}

		.debug-container {
			float: left;
			background-color: #D3D3D3;
			padding-top: 15px;
			padding-bottom: 15px;
			width: 50%;
			height: 120px;
			text-align: center;
		}

		.param-input {
			width: 70px;
		}

	</style>

</head>

<body onload="init()">

	<div class="content-container">
		<!-- div for api iframe -->
		<div id="insidemaps-virtual-tour" class="virtual-tour-container"></div>

		<div id="camera-container" class="debug-container">
			<b>Camera</b><br>
			<div>
				Position:
				x: <input id="camera-position-x" type="text" class="param-input">
				y: <input id="camera-position-y" type="text" class="param-input">
				z: <input id="camera-position-z" type="text" class="param-input">
			</div>
			<div>
				Look At:
				x: <input id="camera-lookat-x" type="text" class="param-input">
				y: <input id="camera-lookat-y" type="text" class="param-input">
				z: <input id="camera-lookat-z" type="text" class="param-input">
			</div>
			<button class="action-button" style="margin-top: 10px;" onclick="updateCameraWithInputParams()" disabled>Update</button>
		</div>

		<div id="material-position" class="debug-container">
			<b>Material</b><br>
			<div>
				Material ID:
				<span id="material-id" style="width: 250px;">Unknown</span>
				<button class="action-button" onclick="highlightSelectedMaterial( true )" disabled>Highlight</button>
				<button class="action-button" onclick="highlightSelectedMaterial( false )" disabled>Unhighlight</button>
			</div>
			<div>
				Origin:
				x: <input id="material-origin-x" type="text" class="param-input" value="0">
				y: <input id="material-origin-y" type="text" class="param-input" value="0">
				z: <input id="material-origin-z" type="text" class="param-input"value="0">
			</div>
			<div>
				Direction:
				x: <input id="material-direction-x" type="text" class="param-input" value="0">
				y: <input id="material-direction-y" type="text" class="param-input" value="-1">
				z: <input id="material-direction-z" type="text" class="param-input" value="0">
			</div>
			<button class="action-button" style="margin-top: 10px;" onclick="selectMaterialWithInputParams()" disabled>Lookup With Input Data</button>
			<button class="action-button" style="margin-top: 10px;" onclick="selectMaterialWithCameraParams()" disabled>Lookup With Camera Data</button>
		</div>
	</div>

	<script>

		var virtualTour;
		var selectedMaterialId;

		function init() {

			virtualTour = new InsideMaps.VirtualTour();
			virtualTour.init({
				domTargetId: 'insidemaps-virtual-tour',
				host: 'http://demo.insidemaps.com',  // defaults to www.insidemaps.com
				model: 'Australia',
				offline: true
			})

			.then( function( data ) {
				virtualTour.addCameraEventListener( onCameraUpdate )

				.then( function() {
					var actionButtons = document.getElementsByClassName( 'action-button' );
					Array.prototype.forEach.call( actionButtons, function( button ) {
						button.disabled = false;
					} );
				});
			});

		}

		///////////////////////
		// Utility functions //
		///////////////////////

		function parseCameraData( cameraData ) {

			var x = cameraData.x.toFixed( 2 );
			var y = cameraData.y.toFixed( 2 );
			var z = cameraData.z.toFixed( 2 );

			return { x: x, y: y, z: z };

		}

		function vectorToString( vector ) {

			return 'x: ' + vector.x + ', y: ' + vector.y + ', z: ' + vector.z;

		}

		function vectorFromInputs( inputXId, inputYId, inputZId ) {

			var x = parseFloat( document.getElementById( inputXId ).value );
			var y = parseFloat( document.getElementById( inputYId ).value );
			var z = parseFloat( document.getElementById( inputZId ).value );

			if ( !isNaN( x ) && !isNaN( y ) && !isNaN( z ) ) {
				return { x: x, y: y, z: z };
			}

			return null;

		}

		function populateInputsFromVector( vector, inputXId, inputYId, inputZId ) {

			document.getElementById( inputXId ).value = vector.x;
			document.getElementById( inputYId ).value = vector.y;
			document.getElementById( inputZId ).value = vector.z;

		}

		/////////////////////////
		// Camera demo section //
		/////////////////////////

		function updateCameraWithInputParams() {

			var position = vectorFromInputs( 'camera-position-x', 'camera-position-y', 'camera-position-z' );
			var lookAt = vectorFromInputs( 'camera-lookat-x', 'camera-lookat-y', 'camera-lookat-z' );

			if ( position || lookAt ) {
				virtualTour.setCameraParams( position, lookAt );
			}

		}

		function onCameraUpdate( cameraData ) {

			var positionVector = parseCameraData( cameraData.position );
			var lookAtVector = parseCameraData( cameraData.lookAt );

			populateInputsFromVector( positionVector, 'camera-position-x', 'camera-position-y', 'camera-position-z' );
			populateInputsFromVector( lookAtVector, 'camera-lookat-x', 'camera-lookat-y', 'camera-lookat-z' );

		}

		///////////////////////////
		// Material demo section //
		///////////////////////////

		function selectMaterial( origin, direction ) {

			if ( origin && direction ) {

				virtualTour.getMaterialIdForIntersection( origin, direction )

				.then( function( materialId ) {
					selectedMaterialId = materialId;

					var materialString = selectedMaterialId ? selectedMaterialId : 'Unknown';
					document.getElementById( 'material-id' ).innerHTML = materialString;
				} );

			}

		}

		function selectMaterialWithInputParams() {

			var origin = vectorFromInputs( 'material-origin-x', 'material-origin-y', 'material-origin-z' );
			var direction = vectorFromInputs( 'material-direction-x', 'material-direction-y', 'material-direction-z' );

			selectMaterial( origin, direction );

		}

		function selectMaterialWithCameraParams() {

			var origin = vectorFromInputs( 'camera-position-x', 'camera-position-y', 'camera-position-z' );
			var direction = vectorFromInputs( 'camera-lookat-x', 'camera-lookat-y', 'camera-lookat-z' );

			selectMaterial( origin, direction );

		}

		function highlightSelectedMaterial( highlight ) {

			if ( selectedMaterialId ) {

				if ( !!highlight ) {
					virtualTour.highlightMaterial( selectedMaterialId );
				} else {
					virtualTour.unhighlightMaterial( selectedMaterialId );
				}

			}

		}

	</script>

</body>

</html>
