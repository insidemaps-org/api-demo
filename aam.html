<!DOCTYPE html>
<html lang="en">

<head>

	<!-- Page style and script -->
	<script type='application/javascript' src='http://demo.insidemaps.com/apis/build/imapi.min.js'></script>

	<title>InsideMaps AAM Demo</title>

	<style>
		.content-container {
			position: relative;
			width: 946px;
			height: 582px;
			display: block;
			margin-left: auto;
			margin-right: auto;
		}

		.virtual-tour-container {
			position: relative;
			width: 100%;
			height: 90%;
		}

		.debug-container {
			float: left;
			background-color: #D3D3D3;
			padding-top: 15px;
			padding-bottom: 15px;
			width: 100%;
			height: 10%;
			text-align: center;
		}

		.param-input {
			width: 70px;
		}

	</style>

</head>

<body onload="init()">

	<div class="content-container">
		<!-- div for api iframe -->
		<div id="insidemaps-virtual-tour" class="virtual-tour-container"></div>

		<div id="camera-position" class="debug-container">
			Position: x: <input id="position-x" type="text" class="param-input"> y: <input id="position-y" type="text" class="param-input"> z: <input id="position-z" type="text" class="param-input"><br>
			Look At: x: <input id="lookat-x" type="text" class="param-input"> y: <input id="lookat-y" type="text" class="param-input"> z: <input id="lookat-z" type="text" class="param-input"><br>
			<button id="cameraUpdateButton" style="margin-top: 10px;" onclick="updateFromInputs()" disabled>Update</button>
		</div>
	</div>

	<script>

		var virtualTour;

		function init() {

			virtualTour = new InsideMaps.VirtualTour();
			virtualTour.init({
				domTargetId: 'insidemaps-virtual-tour',
				host: 'http://demo.insidemaps.com',  // defaults to www.insidemaps.com
				model: 'Australia',
				offline: true
			})

			.then( function( data ) {
				virtualTour.addCameraEventListener( onCameraUpdate )

				.then( function() {
					document.getElementById( 'cameraUpdateButton' ).disabled = false;
				});
			});

		}

		/* Utility conversion functions */

		function cameraDataToVector( cameraData ) {

			var x = parseFloat( cameraData.x ).toFixed( 2 );
			var y = parseFloat( cameraData.y ).toFixed( 2 );
			var z = parseFloat( cameraData.z ).toFixed( 2 );

			return { x: x, y: y, z: z };

		}

		function vectorToString( vector ) {

			return 'x: ' + vector.x + ', y: ' + vector.y + ', z: ' + vector.z;

		}

		function updateFromInputs() {

			var position, lookAt;

			var posX = parseFloat( document.getElementById( 'position-x' ).value );
			var posY = parseFloat( document.getElementById( 'position-y' ).value );
			var posZ = parseFloat( document.getElementById( 'position-z' ).value );

			if ( !isNaN( posX ) && !isNaN( posY ) && !isNaN( posZ ) ) {
				position = { x: posX, y: posY, z: posZ };
			}

			var lookAtX = parseFloat( document.getElementById( 'lookat-x' ).value );
			var lookAtY = parseFloat( document.getElementById( 'lookat-y' ).value );
			var lookAtZ = parseFloat( document.getElementById( 'lookat-z' ).value );

			if ( !isNaN( lookAtX ) && !isNaN( lookAtY ) && !isNaN( lookAtZ ) ) {
				lookAt = { x: lookAtX, y: lookAtY, z: lookAtZ };
			}

			if ( position || lookAt ) {
				var cameraParams = {};
				if ( position ) cameraParams.position = position;
				if ( lookAt ) cameraParams.lookAt = lookAt;

				virtualTour.setCameraParams( cameraParams );
			}

		}

		function onCameraUpdate( cameraData ) {

			var positionVector = cameraDataToVector( cameraData.position );
			var lookAtVector = cameraDataToVector( cameraData.lookAt );

			document.getElementById( 'position-x' ).value = positionVector.x;
			document.getElementById( 'position-y' ).value = positionVector.y;
			document.getElementById( 'position-z' ).value = positionVector.z;

			document.getElementById( 'lookat-x' ).value = lookAtVector.x;
			document.getElementById( 'lookat-y' ).value = lookAtVector.y;
			document.getElementById( 'lookat-z' ).value = lookAtVector.z;

		}

	</script>

</body>

</html>
